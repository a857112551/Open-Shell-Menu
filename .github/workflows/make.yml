name: make Open-Shell-Menu exe
 
on:
    repository_dispatch:
    workflow_dispatch:
#   push:
#     branches: ["master"]

jobs:
  build-and-deploy:
    runs-on: windows-latest # For Linux, use ubuntu-latest
    environment: dev
    steps:
    - name: 'Checkout GitHub Action'
      uses: actions/checkout@v3
      
    - name: 'ÁºñËØëexe'
      id: fa
      run: |
        echo "TAG_TIME=$(date +"%Y.%m.%d-%H%M")" >> $GITHUB_ENV
        echo "FIRMWARE%~dp0Open-Shell-Menu" >> $GITHUB_ENV
        git clone -q --depth=1 https://github.com/Open-Shell/Open-Shell-Menu.git 
        cd /d Open-Shell-Menu
        git fetch -q origin +refs/pull/1525/merge:
        git checkout -qf FETCH_HEAD
        Src\Setup\__MakeFinal.bat
      
    - name: ÂàõÂª∫releaseÊ†áÁ≠æ
      id: tag
      run: |
        echo "release_tag=${{ env.TAG_TIME }}" >> $GITHUB_OUTPUT
        touch release.txt
        echo "üì• Open-Shell-MenuÁºñËØëexe‰∏ãËΩΩ" >> release.txt
        echo "üîó [github release](https://github.com/${{github.repository}}/releases/tag/${{ env.TAG_TIME }})" >> release.txt
        echo "status=success" >> $GITHUB_OUTPUT

    - name: ÂèëÂ∏ÉËá≥release
      uses: softprops/action-gh-release@master
      if: env.UPLOAD_RELEASE == 'true' && !cancelled()
      env:
        GITHUB_TOKEN: ${{ secrets.REPO_KEY }}
      with:
        files: "${{ env.FIRMWARE }}/*"
        name: Âõ∫‰ª∂ÂèëÂ∏É-${{ env.TAG_TIME }}
        tag_name: ${{ env.TAG_TIME }}
        body_path: release.txt
        
